# Matrix storage conventions

This page goes over conventions for matrix storage in AARMBEM.jl. The
matrices ``K_{\mathrm{I}}`` and ``G^{(0)}`` are stored separately for
each individual molecular body labeled ``n``. Such a matrix ``A`` for
an individual molecular body with ``N`` atoms, with elements
``A_{pi,qj}`` for atoms ``p, q \in \{1, 2, \ldots, N\}`` and Cartesian
direction indices ``i, j \in \{x, y, z\}`` is stored in the form
```math
A = \begin{bmatrix}
A_{1x,1x} & A_{1x,1y} & A_{1x,1z} & A_{1x,2x} & A_{1x,2y} & A_{1x,2z} & \ldots & A_{1x,Nx} & A_{1x,Ny} & A_{1x,Nz} \\
A_{1y,1x} & A_{1y,1y} & A_{1y,1z} & A_{1y,2x} & A_{1y,2y} & A_{1y,2z} & \ldots & A_{1y,Nx} & A_{1y,Ny} & A_{1y,Nz} \\
A_{1z,1x} & A_{1z,1y} & A_{1z,1z} & A_{1z,2x} & A_{1z,2y} & A_{1z,2z} & \ldots & A_{1z,Nx} & A_{1z,Ny} & A_{1z,Nz} \\
A_{2x,1x} & A_{2x,1y} & A_{2x,1z} & A_{2x,2x} & A_{2x,2y} & A_{2x,2z} & \ldots & A_{2x,Nx} & A_{2x,Ny} & A_{2x,Nz} \\
A_{2y,1x} & A_{2y,1y} & A_{2y,1z} & A_{2y,2x} & A_{2y,2y} & A_{2y,2z} & \ldots & A_{2y,Nx} & A_{2y,Ny} & A_{2y,Nz} \\
A_{2z,1x} & A_{2z,1y} & A_{2z,1z} & A_{2z,2x} & A_{2z,2y} & A_{2z,2z} & \ldots & A_{2z,Nx} & A_{2z,Ny} & A_{2z,Nz} \\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots \\
A_{Nx,1x} & A_{Nx,1y} & A_{Nx,1z} & A_{Nx,2x} & A_{Nx,2y} & A_{Nx,2z} & \ldots & A_{Nx,Nx} & A_{Nx,Ny} & A_{Nx,Nz} \\
A_{Ny,1x} & A_{Ny,1y} & A_{Ny,1z} & A_{Ny,2x} & A_{Ny,2y} & A_{Ny,2z} & \ldots & A_{Ny,Nx} & A_{Ny,Ny} & A_{Ny,Nz} \\
A_{Nz,1x} & A_{Nz,1y} & A_{Nz,1z} & A_{Nz,2x} & A_{Nz,2y} & A_{Nz,2z} & \ldots & A_{Nz,Nx} & A_{Nz,Ny} & A_{Nz,Nz}
\end{bmatrix}
```
in AARMBEM.jl, so this is a ``3N \times 3N`` matrix.

The overall T-operator and Green's function matrices ``T`` and
``G^{\mathrm{mac}}`` must be stored for all molecular bodies
together. Such a matrix ``X`` for the whole system has matrix blocks
``X_{mn}`` for molecules ``m, n \in \{1, 2, \ldots,
N_{\mathrm{mol}}\}``. The actual storage in AARMBEM.jl is as a full
matrix, but representing it compactly in this page is
difficult. Instead, it will be represented in this page in block form
as
```math
X = \begin{bmatrix}
X_{1,1} & X_{1,2} & \ldots & X_{1,N_{\mathrm{mol}}} \\
X_{2,1} & X_{2,2} & \ldots & X_{2,N_{\mathrm{mol}}} \\
\vdots & \vdots & \ddots & \vdots \\
X_{N_{\mathrm{mol}},1} & X_{N_{\mathrm{mol}},2} & \ldots & X_{N_{\mathrm{mol}},N_{\mathrm{mol}}}
\end{bmatrix}
```
where each block is expanded as
```math
X_{mn} = \begin{bmatrix}
(X_{mn})_{1x,1x} & (X_{mn})_{1x,1y} & (X_{mn})_{1x,1z} & (X_{mn})_{1x,2x} & (X_{mn})_{1x,2y} & (X_{mn})_{1x,2z} & \ldots & (X_{mn})_{1x,N_{n}x} & (X_{mn})_{1x,N_{n}y} & (X_{mn})_{1x,N_{n}z} \\
(X_{mn})_{1y,1x} & (X_{mn})_{1y,1y} & (X_{mn})_{1y,1z} & (X_{mn})_{1y,2x} & (X_{mn})_{1y,2y} & (X_{mn})_{1y,2z} & \ldots & (X_{mn})_{1y,N_{n}x} & (X_{mn})_{1y,N_{n}y} & (X_{mn})_{1y,N_{n}z} \\
(X_{mn})_{1z,1x} & (X_{mn})_{1z,1y} & (X_{mn})_{1z,1z} & (X_{mn})_{1z,2x} & (X_{mn})_{1z,2y} & (X_{mn})_{1z,2z} & \ldots & (X_{mn})_{1z,N_{n}x} & (X_{mn})_{1z,N_{n}y} & (X_{mn})_{1z,N_{n}z} \\
(X_{mn})_{2x,1x} & (X_{mn})_{2x,1y} & (X_{mn})_{2x,1z} & (X_{mn})_{2x,2x} & (X_{mn})_{2x,2y} & (X_{mn})_{2x,2z} & \ldots & (X_{mn})_{2x,N_{n}x} & (X_{mn})_{2x,N_{n}y} & (X_{mn})_{2x,N_{n}z} \\
(X_{mn})_{2y,1x} & (X_{mn})_{2y,1y} & (X_{mn})_{2y,1z} & (X_{mn})_{2y,2x} & (X_{mn})_{2y,2y} & (X_{mn})_{2y,2z} & \ldots & (X_{mn})_{2y,N_{n}x} & (X_{mn})_{2y,N_{n}y} & (X_{mn})_{2y,N_{n}z} \\
(X_{mn})_{2z,1x} & (X_{mn})_{2z,1y} & (X_{mn})_{2z,1z} & (X_{mn})_{2z,2x} & (X_{mn})_{2z,2y} & (X_{mn})_{2z,2z} & \ldots & (X_{mn})_{2z,N_{n}x} & (X_{mn})_{2z,N_{n}y} & (X_{mn})_{2z,N_{n}z} \\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots \\
(X_{mn})_{N_{m}x,1x} & (X_{mn})_{N_{m}x,1y} & (X_{mn})_{N_{m}x,1z} & (X_{mn})_{N_{m}x,2x} & (X_{mn})_{N_{m}x,2y} & (X_{mn})_{N_{m}x,2z} & \ldots & (X_{mn})_{N_{m}x,N_{n}x} & (X_{mn})_{N_{m}x,N_{n}y} & (X_{mn})_{N_{m}x,N_{n}z} \\
(X_{mn})_{N_{m}y,1x} & (X_{mn})_{N_{m}y,1y} & (X_{mn})_{N_{m}y,1z} & (X_{mn})_{N_{m}y,2x} & (X_{mn})_{N_{m}y,2y} & (X_{mn})_{N_{m}y,2z} & \ldots & (X_{mn})_{N_{m}y,N_{n}x} & (X_{mn})_{N_{m}y,N_{n}y} & (X_{mn})_{N_{m}y,N_{n}z} \\
(X_{mn})_{N_{m}z,1x} & (X_{mn})_{N_{m}z,1y} & (X_{mn})_{N_{m}z,1z} & (X_{mn})_{N_{m}z,2x} & (X_{mn})_{N_{m}z,2y} & (X_{mn})_{N_{m}z,2z} & \ldots & (X_{mn})_{N_{m}z,N_{n}x} & (X_{mn})_{N_{m}z,N_{n}y} & (X_{mn})_{N_{m}z,N_{n}z}
\end{bmatrix}
```
so these blocks are each ``3N_{m} \times 3N_{n}`` matrices where
molecular body ``m`` has ``N_{m}`` atoms and molecular body ``n`` has
``N_{n}`` atoms.