<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Matrix storage conventions · AARMBEM.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">AARMBEM.jl</span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Background</span><ul><li><a class="tocitem" href="../theory/historicalbackground.html">History</a></li><li><a class="tocitem" href="../theory/theoreticalbackground.html">Theory</a></li><li><a class="tocitem" href="../theory/acronyms.html">Common acronyms</a></li></ul></li><li><span class="tocitem">Implementation Notes</span><ul><li><a class="tocitem" href="units.html">Units</a></li><li class="is-active"><a class="tocitem" href="matrixstorage.html">Matrix storage conventions</a><ul class="internal"><li><a class="tocitem" href="#Matrix-element-ordering-1"><span>Matrix element ordering</span></a></li><li><a class="tocitem" href="#Matrices-in-thermal-radiation-powers-1"><span>Matrices in thermal radiation powers</span></a></li><li><a class="tocitem" href="#Matrices-in-vdW-interaction-free-energies-1"><span>Matrices in vdW interaction free energies</span></a></li></ul></li><li><a class="tocitem" href="datastructuresandtransformations.html">Data structures and rigid transformations</a></li><li><a class="tocitem" href="performancenotes.html">Performance notes and required packages</a></li><li><a class="tocitem" href="outputquantities.html">Output quantities</a></li><li><a class="tocitem" href="ewaldwarning.html">Warning: Ewald summation</a></li></ul></li><li><span class="tocitem">Usage</span><ul><li><a class="tocitem" href="../usage/configfiles.html">Configuration files</a></li><li><a class="tocitem" href="../usage/transfiles.html">Transformation files</a></li><li><a class="tocitem" href="../usage/periodicfiles.html">Bloch periodicity files</a></li><li><a class="tocitem" href="../usage/freqkfiles.html">Frequency and Bloch wavevector files</a></li><li><a class="tocitem" href="../usage/CMDARGS.html">Command-line arguments</a></li><li><a class="tocitem" href="../usage/outfiles.html">Output file structure</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/guaninecytosinePEC.html">Guanine + cytosine + PEC plane</a></li><li><a class="tocitem" href="../examples/2grapheneVAC.html">Two identical parallel graphene sheets (vacuum)</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../api/CMDARGS.html">Command-line arguments</a></li><li><a class="tocitem" href="../api/expintegral.html">Exponential integral function</a></li><li><a class="tocitem" href="../api/genericmatrixvectorutils.html">Generic matrix and vector utilities</a></li><li><a class="tocitem" href="../api/greensfunctions.html">Maxwell Green&#39;s functions</a></li><li><a class="tocitem" href="../api/periodicdata.html">Data structures and functions for Bloch periodicity</a></li><li><a class="tocitem" href="../api/moldata.html">Molecular data structures and methods</a></li><li><a class="tocitem" href="../api/transdata.html">Transformation data structures and methods</a></li><li><a class="tocitem" href="../api/vdWRHT.html">vdW interactions and thermal radiation functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Implementation Notes</a></li><li class="is-active"><a href="matrixstorage.html">Matrix storage conventions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="matrixstorage.html">Matrix storage conventions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/psv2/AARMBEM.jl/blob/master/doc/src/implementation/matrixstorage.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Matrix-storage-conventions-1"><a class="docs-heading-anchor" href="#Matrix-storage-conventions-1">Matrix storage conventions</a><a class="docs-heading-anchor-permalink" href="#Matrix-storage-conventions-1" title="Permalink"></a></h1><p>This page goes over conventions for matrix storage in AARMBEM.jl. Additionally, there are subtle differences in how matrices are stored when computing vdW interaction free energy integrands versus when computing thermal radiation spectra, so these are discussed too.</p><h2 id="Matrix-element-ordering-1"><a class="docs-heading-anchor" href="#Matrix-element-ordering-1">Matrix element ordering</a><a class="docs-heading-anchor-permalink" href="#Matrix-element-ordering-1" title="Permalink"></a></h2><p>The matrices <span>$K_{\mathrm{I}}$</span> and <span>$G^{(0)}$</span> are stored separately for each individual molecular body labeled <span>$n$</span>. Such a matrix <span>$A$</span> for an individual molecular body with <span>$N$</span> atoms, with elements <span>$A_{pi,qj}$</span> for atoms <span>$p, q \in \{1, 2, \ldots, N\}$</span> and Cartesian direction indices <span>$i, j \in \{x, y, z\}$</span> is stored in the form</p><div>\[A = \begin{bmatrix}
A_{1x,1x} &amp; A_{1x,1y} &amp; A_{1x,1z} &amp; A_{1x,2x} &amp; A_{1x,2y} &amp; A_{1x,2z} &amp; \ldots &amp; A_{1x,Nx} &amp; A_{1x,Ny} &amp; A_{1x,Nz} \\
A_{1y,1x} &amp; A_{1y,1y} &amp; A_{1y,1z} &amp; A_{1y,2x} &amp; A_{1y,2y} &amp; A_{1y,2z} &amp; \ldots &amp; A_{1y,Nx} &amp; A_{1y,Ny} &amp; A_{1y,Nz} \\
A_{1z,1x} &amp; A_{1z,1y} &amp; A_{1z,1z} &amp; A_{1z,2x} &amp; A_{1z,2y} &amp; A_{1z,2z} &amp; \ldots &amp; A_{1z,Nx} &amp; A_{1z,Ny} &amp; A_{1z,Nz} \\
A_{2x,1x} &amp; A_{2x,1y} &amp; A_{2x,1z} &amp; A_{2x,2x} &amp; A_{2x,2y} &amp; A_{2x,2z} &amp; \ldots &amp; A_{2x,Nx} &amp; A_{2x,Ny} &amp; A_{2x,Nz} \\
A_{2y,1x} &amp; A_{2y,1y} &amp; A_{2y,1z} &amp; A_{2y,2x} &amp; A_{2y,2y} &amp; A_{2y,2z} &amp; \ldots &amp; A_{2y,Nx} &amp; A_{2y,Ny} &amp; A_{2y,Nz} \\
A_{2z,1x} &amp; A_{2z,1y} &amp; A_{2z,1z} &amp; A_{2z,2x} &amp; A_{2z,2y} &amp; A_{2z,2z} &amp; \ldots &amp; A_{2z,Nx} &amp; A_{2z,Ny} &amp; A_{2z,Nz} \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots \\
A_{Nx,1x} &amp; A_{Nx,1y} &amp; A_{Nx,1z} &amp; A_{Nx,2x} &amp; A_{Nx,2y} &amp; A_{Nx,2z} &amp; \ldots &amp; A_{Nx,Nx} &amp; A_{Nx,Ny} &amp; A_{Nx,Nz} \\
A_{Ny,1x} &amp; A_{Ny,1y} &amp; A_{Ny,1z} &amp; A_{Ny,2x} &amp; A_{Ny,2y} &amp; A_{Ny,2z} &amp; \ldots &amp; A_{Ny,Nx} &amp; A_{Ny,Ny} &amp; A_{Ny,Nz} \\
A_{Nz,1x} &amp; A_{Nz,1y} &amp; A_{Nz,1z} &amp; A_{Nz,2x} &amp; A_{Nz,2y} &amp; A_{Nz,2z} &amp; \ldots &amp; A_{Nz,Nx} &amp; A_{Nz,Ny} &amp; A_{Nz,Nz}
\end{bmatrix}\]</div><p>in AARMBEM.jl, so this is a <span>$3N \times 3N$</span> matrix.</p><p>The overall T-operator and Green&#39;s function matrices <span>$T$</span> and <span>$G^{\mathrm{mac}}$</span> must be stored for all molecular bodies together. Such a matrix <span>$X$</span> for the whole system has matrix blocks <span>$X_{mn}$</span> for molecules <span>$m, n \in \{1, 2, \ldots, N_{\mathrm{mol}}\}$</span>. The actual storage in AARMBEM.jl is as a full matrix, but representing it compactly in this page is difficult. Instead, it will be represented in this page in block form as</p><div>\[X = \begin{bmatrix}
X_{1,1} &amp; X_{1,2} &amp; \ldots &amp; X_{1,N_{\mathrm{mol}}} \\
X_{2,1} &amp; X_{2,2} &amp; \ldots &amp; X_{2,N_{\mathrm{mol}}} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{N_{\mathrm{mol}},1} &amp; X_{N_{\mathrm{mol}},2} &amp; \ldots &amp; X_{N_{\mathrm{mol}},N_{\mathrm{mol}}}
\end{bmatrix}\]</div><p>where each block is expanded as</p><div>\[X_{mn} = \begin{bmatrix}
(X_{mn})_{1x,1x} &amp; (X_{mn})_{1x,1y} &amp; (X_{mn})_{1x,1z} &amp; (X_{mn})_{1x,2x} &amp; (X_{mn})_{1x,2y} &amp; (X_{mn})_{1x,2z} &amp; \ldots &amp; (X_{mn})_{1x,N_{n}x} &amp; (X_{mn})_{1x,N_{n}y} &amp; (X_{mn})_{1x,N_{n}z} \\
(X_{mn})_{1y,1x} &amp; (X_{mn})_{1y,1y} &amp; (X_{mn})_{1y,1z} &amp; (X_{mn})_{1y,2x} &amp; (X_{mn})_{1y,2y} &amp; (X_{mn})_{1y,2z} &amp; \ldots &amp; (X_{mn})_{1y,N_{n}x} &amp; (X_{mn})_{1y,N_{n}y} &amp; (X_{mn})_{1y,N_{n}z} \\
(X_{mn})_{1z,1x} &amp; (X_{mn})_{1z,1y} &amp; (X_{mn})_{1z,1z} &amp; (X_{mn})_{1z,2x} &amp; (X_{mn})_{1z,2y} &amp; (X_{mn})_{1z,2z} &amp; \ldots &amp; (X_{mn})_{1z,N_{n}x} &amp; (X_{mn})_{1z,N_{n}y} &amp; (X_{mn})_{1z,N_{n}z} \\
(X_{mn})_{2x,1x} &amp; (X_{mn})_{2x,1y} &amp; (X_{mn})_{2x,1z} &amp; (X_{mn})_{2x,2x} &amp; (X_{mn})_{2x,2y} &amp; (X_{mn})_{2x,2z} &amp; \ldots &amp; (X_{mn})_{2x,N_{n}x} &amp; (X_{mn})_{2x,N_{n}y} &amp; (X_{mn})_{2x,N_{n}z} \\
(X_{mn})_{2y,1x} &amp; (X_{mn})_{2y,1y} &amp; (X_{mn})_{2y,1z} &amp; (X_{mn})_{2y,2x} &amp; (X_{mn})_{2y,2y} &amp; (X_{mn})_{2y,2z} &amp; \ldots &amp; (X_{mn})_{2y,N_{n}x} &amp; (X_{mn})_{2y,N_{n}y} &amp; (X_{mn})_{2y,N_{n}z} \\
(X_{mn})_{2z,1x} &amp; (X_{mn})_{2z,1y} &amp; (X_{mn})_{2z,1z} &amp; (X_{mn})_{2z,2x} &amp; (X_{mn})_{2z,2y} &amp; (X_{mn})_{2z,2z} &amp; \ldots &amp; (X_{mn})_{2z,N_{n}x} &amp; (X_{mn})_{2z,N_{n}y} &amp; (X_{mn})_{2z,N_{n}z} \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots \\
(X_{mn})_{N_{m}x,1x} &amp; (X_{mn})_{N_{m}x,1y} &amp; (X_{mn})_{N_{m}x,1z} &amp; (X_{mn})_{N_{m}x,2x} &amp; (X_{mn})_{N_{m}x,2y} &amp; (X_{mn})_{N_{m}x,2z} &amp; \ldots &amp; (X_{mn})_{N_{m}x,N_{n}x} &amp; (X_{mn})_{N_{m}x,N_{n}y} &amp; (X_{mn})_{N_{m}x,N_{n}z} \\
(X_{mn})_{N_{m}y,1x} &amp; (X_{mn})_{N_{m}y,1y} &amp; (X_{mn})_{N_{m}y,1z} &amp; (X_{mn})_{N_{m}y,2x} &amp; (X_{mn})_{N_{m}y,2y} &amp; (X_{mn})_{N_{m}y,2z} &amp; \ldots &amp; (X_{mn})_{N_{m}y,N_{n}x} &amp; (X_{mn})_{N_{m}y,N_{n}y} &amp; (X_{mn})_{N_{m}y,N_{n}z} \\
(X_{mn})_{N_{m}z,1x} &amp; (X_{mn})_{N_{m}z,1y} &amp; (X_{mn})_{N_{m}z,1z} &amp; (X_{mn})_{N_{m}z,2x} &amp; (X_{mn})_{N_{m}z,2y} &amp; (X_{mn})_{N_{m}z,2z} &amp; \ldots &amp; (X_{mn})_{N_{m}z,N_{n}x} &amp; (X_{mn})_{N_{m}z,N_{n}y} &amp; (X_{mn})_{N_{m}z,N_{n}z}
\end{bmatrix}\]</div><p>so these blocks are each <span>$3N_{m} \times 3N_{n}$</span> matrices where molecular body <span>$m$</span> has <span>$N_{m}$</span> atoms and molecular body <span>$n$</span> has <span>$N_{n}$</span> atoms.</p><h2 id="Matrices-in-thermal-radiation-powers-1"><a class="docs-heading-anchor" href="#Matrices-in-thermal-radiation-powers-1">Matrices in thermal radiation powers</a><a class="docs-heading-anchor-permalink" href="#Matrices-in-thermal-radiation-powers-1" title="Permalink"></a></h2><p>For thermal radiation powers and vdW interaction free energies, the T-operator of the system is paramount. For thermal radiation in particular, the T-operator matrix is constructed by storing <span>$\alpha_{n}^{-1}$</span>, <span>$G^{(0)}_{nn}$</span>, and <span>$G^{\mathrm{mac}}$</span>: in particular, the total system inverse polarizability matrix is the direct sum over individual blocks <span>$\alpha^{-1} = \bigoplus_{n = 1}^{N_{\mathrm{mol}}} \alpha_{n}^{-1}$</span>, and from this <span>$T = (\alpha^{-1} - G^{\mathrm{mac}})^{-1}$</span> (where <span>$G^{\mathrm{mac}}$</span> would have contributions from <span>$G^{(0)}_{nn}$</span> stamped into the diagonal blocks as appropriate). Note that <span>$\alpha_{n}$</span> is computed for the purposes of computing atomic polarizabilities for the Gaussian basis functions, but it is more useful to store and more efficient to compute <span>$\alpha_{n}^{-1} = Q_{\mathrm{e}n}^{-1} (K_{\mathrm{e}n} - \mathrm{i}\omega B_{\mathrm{e}n} - \omega^{2} M_{\mathrm{e}n} - K_{\mathrm{e}n} (K_{\mathrm{e}n} + K_{\mathrm{I}n} - \mathrm{i}\omega B_{\mathrm{I}n} - \omega^{2} M_{\mathrm{I}n})^{-1} K_{\mathrm{e}n}) Q_{\mathrm{e}n}^{-1}$</span> so <span>$\alpha_{n}$</span> per se is not stored long-term.</p><h2 id="Matrices-in-vdW-interaction-free-energies-1"><a class="docs-heading-anchor" href="#Matrices-in-vdW-interaction-free-energies-1">Matrices in vdW interaction free energies</a><a class="docs-heading-anchor-permalink" href="#Matrices-in-vdW-interaction-free-energies-1" title="Permalink"></a></h2><p>There are a few differences in the matrices used for computing vdW interactions compared to those for computing thermal radiation. These changes are for the sake of greater efficiency and numerical accuracy. The expressions below are quoted for generic <span>$\omega$</span> but evaluated specifically for <span>$\omega = \mathrm{i}\xi$</span>.</p><p>The biggest change is that although the polarizability matrices <span>$\alpha_{n}$</span> are computed for each molecular body <span>$n$</span> for computing the atomic polarizabilities for the Gaussian basis functions, neither <span>$\alpha_{n}$</span> nor <span>$\alpha_{n}^{-1}$</span> are stored per se, and <span>$\alpha_{n}$</span> are only computed in order to compute the atomic polarizabilities entering the Gaussian basis functions. Instead, the matrices <span>$\alpha_{\mathrm{e}n} \alpha_{n}^{-1} = I_{n} - Q_{\mathrm{e}n} (K_{\mathrm{e}n} - \mathrm{i}\omega B_{\mathrm{e}n} - \omega^{2} M_{\mathrm{e}n})^{-1} K_{\mathrm{e}n} (K_{\mathrm{e}n} + K_{\mathrm{I}n} - \mathrm{i}\omega B_{\mathrm{I}n} - \omega^{2} M_{\mathrm{I}n})^{-1} K_{\mathrm{e}n} Q_{\mathrm{e}n}^{-1}$</span> (where <span>$I_{n}$</span> is the <span>$3N_{n} \times 3N_{n}$</span> identity matrix for molecular body <span>$n$</span>) are explicitly computed, having defined an effective electronic polarizability matrix <span>$\alpha_{\mathrm{e}n} = Q_{\mathrm{e}n} (K_{\mathrm{e}n} - \mathrm{i}\omega B_{\mathrm{e}n} - \omega^{2} M_{\mathrm{e}n})^{-1} Q_{\mathrm{e}n}$</span>. Furthermore, instead of storing the matrices <span>$G^{(0)}_{nn}$</span> or <span>$G^{\mathrm{mac}}$</span>, the matrices <span>$\alpha_{\mathrm{e}n} G^{(0)}_{nn}$</span> and <span>$\alpha_{\mathrm{e}} G^{\mathrm{mac}}$</span> are stored, where <span>$\alpha_{\mathrm{e}} = \bigoplus_{n = 1}^{N_{\mathrm{mol}}} \alpha_{\mathrm{e}n}$</span>.</p><p>Effectively, the matrices <span>$\alpha_{\mathrm{e}n}$</span> are efficient preconditioners for the matrices involved in computing the vdW interaction free energy integrand, which is evaluated as <span>$f(\mathrm{i}\xi) = \ln(\det[\alpha_{\mathrm{e}} \alpha^{-1} - \alpha_{\mathrm{e}} G^{\mathrm{mac}}]) - \sum_{n = 1}^{N_{\mathrm{mol}}} \ln(\det[\alpha_{\mathrm{e}n} \alpha_{n}^{-1} - \alpha_{\mathrm{e}n} G^{(0)}_{nn}])$</span>. Furthermore, the fact that all of the matrices required to compute <span>$\alpha_{\mathrm{e}n}$</span> for each <span>$n$</span> are stored efficiently as <span>$N_{n}$</span>-element vectors means the same is true of <span>$\alpha_{\mathrm{e}n}$</span>, and pre-multiplication by a diagonal matrix can be done efficiently.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="units.html">« Units</a><a class="docs-footer-nextpage" href="datastructuresandtransformations.html">Data structures and rigid transformations »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 27 May 2020 14:09">Wednesday 27 May 2020</span>. Using Julia version 1.0.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
